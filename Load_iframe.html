<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />

    <title></title>

    <style type="text/css">
      body {
        margin: 0;
        padding: 0;
        -ms-content-zooming: none;
      }

      #office_frame {
        width: 100%;
        height: calc(100vh - 60px);
        position: absolute;
        border: none;
      }

      .button_group_bottom {
        bottom: 10px;
        position: absolute;
        width: calc(100% - 40px);
        display: flex;
        /*for ie*/
        justify-content: space-around;
        /*for moz & chrome*/
        -webkit-justify-content: space-evenly !important;
        margin: 0px 20px;
      }

      .button_bottom {
        position: relative;
        height: 48px;
        width: 25%;
        color: #22529e;
        cursor: pointer;
        text-decoration: none;
        border: 2px solid #bababa;
        border-radius: 10px;
        background-image: linear-gradient(to top, lightgray 0%, white 100%);
      }

      .button_bottom_text {
        line-height: 48px;
        font-size: 21px;
        font-weight: bold;
        position: absolute;
        height: 48px;
        left: 15px;
        right: 15px;
        top: 0px;
        text-decoration: inherit;
        font-family: Calibri, Lucida Grande, Verdana;
        vertical-align: text-bottom;
      }

      @media screen and (max-width: 870px) {
        .button_bottom_text {
          font-size: 13px;
        }
      }
    </style>
  </head>
  <body>
    <div id="dialog"></div>

    <form id="office_form" name="office_form" target="office_frame" action="#URL#" method="post"></form>

    <div class="button_group_bottom">
      <button id="addRevision_button" class="button_bottom"><div class="button_bottom_text">Add New Revision</div></button>
      <button id="updateRevision_button" class="button_bottom"><div class="button_bottom_text">Save Changes</div></button>
      <button id="keep_changes" class="button_bottom"><div class="button_bottom_text">Keep Changes</div></button>
      <button id="upload_changes" class="button_bottom"><div class="button_bottom_text">Upload Changes</div></button>
      <button id="Accept_withoutchanges" class="button_bottom"><div class="button_bottom_text">Accept Without Changes</div></button>
      <button id="accept_without_comments" class="button_bottom"><div class="button_bottom_text">Accept Without Comments</div></button>
      <button id="accept_with_comments" class="button_bottom"><div class="button_bottom_text">Accept With Comments</div></button>
      <button id="close_button" class="button_bottom"><div class="button_bottom_text">Close Document</div></button>
      <button id="close_review" class="button_bottom"><div class="button_bottom_text">Close</div></button>
    </div>

    <span id="frameholder"></span>
    <script type="text/javascript">
      var mode = '#MODE#'
      var project = '#APP#'
      var frameholder = document.getElementById('frameholder')
      var office_frame = document.createElement('iframe')
      office_frame.name = 'office_frame'
      office_frame.id = 'office_frame'

      // The title should be set for accessibility
      office_frame.title = 'Office Frame'

      // This attribute allows true fullscreen mode in slideshow view
      // when using PowerPoint's 'view' action.
      office_frame.setAttribute('allowfullscreen', 'true')
      //office_frame.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-modals allow-forms allow-popups allow-top-navigation allow-popups-to-escape-sandbox');
      // office_frame.setAttribute('srcdoc', '<script>history.forward()</scr' + 'ipt>');
      frameholder.appendChild(office_frame)
      document.getElementById('office_form').submit()
      //Changing button visibility according to actionMode and Project
      function buttonVisibility() {
        close_button = document.getElementById('close_button')
        addRevision_button = document.getElementById('addRevision_button')
        updateRevision_button = document.getElementById('updateRevision_button')
        upload_changes = document.getElementById('upload_changes')
        Accept_withoutchanges = document.getElementById('Accept_withoutchanges')
        accept_without_comments = document.getElementById('accept_without_comments')
        accept_with_comments = document.getElementById('accept_with_comments')
        keep_changes = document.getElementById('keep_changes')
        close_review = document.getElementById('close_review')

        close_button.style.display = 'none'
        addRevision_button.style.display = 'none'
        updateRevision_button.style.display = 'none'
        upload_changes.style.display = 'none'
        Accept_withoutchanges.style.display = 'none'
        keep_changes.style.display = 'none'
        accept_without_comments.style.display = 'none'
        accept_with_comments.style.display = 'none'
        close_review.style.display = 'none'

        if (mode.toLowerCase() === 'view' && project.toLowerCase() === 'inbox_review_document') {
          document.querySelector('#close_button > div').innerText = 'Return to Inbox'
          close_button.style.display = 'block'
          accept_without_comments.style.display = 'block'
          accept_with_comments.style.display = 'block'
          return
        }

        if (mode.toLowerCase() === 'view') {
          close_button.style.display = 'block'
          return
        } else if (mode.toLowerCase() == 'editnew') {
          close_button.style.display = 'block'
          updateRevision_button.style.display = 'block'
          return
        }

        if (project.toLowerCase() === 'inbox_review_document') {
          document.querySelector('#close_button > div').innerText = 'Return to Inbox'
          close_button.style.display = 'block'
          upload_changes.style.display = 'block'
          Accept_withoutchanges.style.display = 'block'
          keep_changes.style.display = 'block'
          return
        }
        if (project.toLowerCase() === 'inbox_') {
          close_button.style.display = 'block'
          updateRevision_button.style.display = 'block'
          return
        } else if (project.toLowerCase() === 'adminreviewcompare') {
          close_review.style.display = 'block'
          return
        } else if (project.toLowerCase() === 'admin') {
          close_button.style.display = 'block'
          addRevision_button.style.display = 'block'
          return
        } else {
          close_button.style.display = 'block'
          updateRevision_button.style.display = 'block'
          addRevision_button.style.display = 'block'
          return
        }
      }

      buttonVisibility()

      //Sending the message to PolicyHub
      function bindEvent(element, eventName, eventHandler) {
        if (element.addEventListener) {
          element.addEventListener(eventName, eventHandler, false)
        } else if (element.attachEvent) {
          element.attachEvent('on' + eventName, eventHandler)
        }
      }
      var fileExt = '#FILEEXT#'
      var sendMessage = function (msg) {
        // Make sure you are sending a string, and to stringify JSON
        window.parent.postMessage(msg, '*')
        return true
      }
      close_button = document.getElementById('close_button')
      bindEvent(close_button, 'click', function (e) {
        if (window.self == window.top) {
          closeWindow()
        }
        sendMessage('IframeClose')
      })

      addRevision_button = document.getElementById('addRevision_button')
      bindEvent(addRevision_button, 'click', function (e) {
        sendMessage('IframeAdd')
      })
      updateRevision_button = document.getElementById('updateRevision_button')
      bindEvent(updateRevision_button, 'click', function (e) {
        sendMessage('IframeUpdate')
      })
      upload_changes = document.getElementById('upload_changes')
      bindEvent(upload_changes, 'click', function (e) {
        sendMessage('IframeUploadChanges')
      })
      Accept_withoutchanges = document.getElementById('Accept_withoutchanges')
      bindEvent(Accept_withoutchanges, 'click', function (e) {
        sendMessage('IframeAcceptWithoutChanges')
      })
      accept_without_comments = document.getElementById('accept_without_comments')
      bindEvent(accept_without_comments, 'click', function (e) {
        sendMessage('IframeAcceptWithoutComments')
      })
      accept_with_comments = document.getElementById('accept_with_comments')
      bindEvent(accept_with_comments, 'click', function (e) {
        sendMessage('IframeAcceptWithComments')
      })
      keep_changes = document.getElementById('keep_changes')
      bindEvent(keep_changes, 'click', function (e) {
        sendMessage('IframeKeepChanges')
      })
      close_review = document.getElementById('close_review')
      bindEvent(close_review, 'click', function (e) {
        sendMessage('Close')
      })
      function closeWindow() {
        let new_window = open(location, '_self')
        new_window.close()
      }
    </script>
  </body>
</html>
